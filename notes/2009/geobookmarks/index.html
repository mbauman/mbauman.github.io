<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=stylesheet  href="/css/styles.css"> <link rel=icon  href="/assets/favicon.png"> <script src="https://kit.fontawesome.com/8106cce1f2.js" crossorigin=anonymous ></script> <title>iPhone Geolocation Bookmarklets</title> <header> <div class=blog-name ><a href="/">Matt Bauman</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/research/">Research+</a> <li><a href="/projects/">Projects</a> <li><a href="/notes/">Notes</a> <li><a href="/cv/">CV</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class="franklin-content container blog-title"> <h1>iPhone Geolocation Bookmarklets </h1> <h3> <span style="font-weight: lighter; font-style: italic; font-size:smaller"> 06 August 2009 <a type="application/rss+xml" href="/feed.xml"> <i class="fas fa-rss" ></i> </a> </span> </h3> </div> <div class=franklin-content ><h4 id=create_direct_links_to_gps_location-specific_webpages ><a href="#create_direct_links_to_gps_location-specific_webpages" class=header-anchor ><em>Create direct links to GPS location-specific webpages</em></a></h4> <p><img src="/assets/notes/geobookmark.png" alt="Heaven&#39;s Above tracking the ISS on an iPhone" /></p> <p>Very few websites have implemented the new javascript GPS geolocation features that were intruduced with HTML 5. However, there are a few sites that use latitude and longitude directly in their URLs.</p> <p>I first wanted a quick way to get my current latitude and longitude while looking at <a href="http://heavens-above.com/">Heavens Above</a>. It’s a great site that allows you to find visible satellites based upon your current location. Here’s <a href="javascript:navigator.geolocation.getCurrentPosition&#40;function&#40;g&#41;&#123;c&#61;g.coords;z&#61;c.altitude;z&#61;z?z:0;d&#61;new&#37;20Date&#40;2009,0,1,0,0,0,0&#41;.toLocaleString&#40;&#41;.substr&#40;-3,3&#41;;window.location&#61;&#39;http://www.heavens-above.com/?lat&#61;&#39;&#43;c.latitude&#43;&#39;&amp;lng&#61;&#39;&#43;c.longitude&#43;&#39;&amp;alt&#61;&#39;&#43;z&#43;&#39;&amp;loc&#61;iPhone&amp;tz&#61;&#39;&#43;d;&#125;,function&#40;&#41;&#123;alert&#40;&#39;Permission&#37;20denied.&#39;&#41;&#125;&#41;;">the bookmarklet</a> that I created:</p> <pre><code class="javascript hljs"><span class=hljs-attr >javascript</span>:navigator.<span class=hljs-property >geolocation</span>.<span class="hljs-title function_">getCurrentPosition</span>(<span class=hljs-keyword >function</span>(<span class=hljs-params >g</span>){c=g.<span class=hljs-property >coords</span>;z=c.<span class=hljs-property >altitude</span>;z=z?<span class=hljs-attr >z</span>:<span class=hljs-number >0</span>;d=<span class="hljs-title function_">newDate</span>(<span class=hljs-number >2009</span>,<span class=hljs-number >0</span>,<span class=hljs-number >1</span>,<span class=hljs-number >0</span>,<span class=hljs-number >0</span>,<span class=hljs-number >0</span>,<span class=hljs-number >0</span>).<span class="hljs-title function_">toLocaleString</span>().<span class="hljs-title function_">substr</span>(-<span class=hljs-number >3</span>,<span class=hljs-number >3</span>);<span class="hljs-variable language_">window</span>.<span class=hljs-property >location</span>=<span class=hljs-string >&quot;http://www.heavens-above.com/?lat=&quot;</span>+c.<span class=hljs-property >latitude</span>+<span class=hljs-string >&quot;&amp;lng=&quot;</span>+c.<span class=hljs-property >longitude</span>+<span class=hljs-string >&quot;&amp;alt=&quot;</span>+z+<span class=hljs-string >&quot;&amp;loc=iPhone&amp;tz=&quot;</span>+d;},<span class=hljs-keyword >function</span>(<span class=hljs-params ></span>){<span class="hljs-title function_">alert</span>(<span class=hljs-string >&quot;Permission denied.&quot;</span>)});</code></pre>
<p>Copy <a href="javascript:navigator.geolocation.getCurrentPosition&#40;function&#40;g&#41;&#123;c&#61;g.coords;z&#61;c.altitude;z&#61;z?z:0;d&#61;new&#37;20Date&#40;2009,0,1,0,0,0,0&#41;.toLocaleString&#40;&#41;.substr&#40;-3,3&#41;;window.location&#61;&#39;http://www.heavens-above.com/?lat&#61;&#39;&#43;c.latitude&#43;&#39;&amp;lng&#61;&#39;&#43;c.longitude&#43;&#39;&amp;alt&#61;&#39;&#43;z&#43;&#39;&amp;loc&#61;iPhone&amp;tz&#61;&#39;&#43;d;&#125;,function&#40;&#41;&#123;alert&#40;&#39;Permission&#37;20denied.&#39;&#41;&#125;&#41;;">this link to your bookmarks</a> and when accessed on an iPhone or location-aware web browser, it will directly load the site with your current location entered&#33;</p>
<p>I had to jump through several hoops here. When the altitude is not available &#40;when only using cell-tower triangulation&#41;, the javascript code returns <code>null</code>. The website only supports numeric values, so <code>z&#61;z?z:0</code> replaces the <code>null</code> with a <code>0</code>. Secondly, the website needs the local timezone, but unfortunately it only accepts a small subset of the three letter codes &#40;and not the numeric offset from UTC&#41;. Even worse, the daylight savings version of the code &#40;EDT/CDT/MDT/PDT&#41; are unsupported – the site just assumes that you follow the trend &#40;sorry Arizona&#41;. So I grab the code from January 1, 2009 &#40;when daylight savings is not in effect&#41;, and parse the three letter code from that string.</p>
<p>For most sites, you’d only need something of the form &#40;<a href="javascript:navigator.geolocation.getCurrentPosition&#40;function&#40;g&#41;&#123;c&#61;g.coords;window.location&#61;&#39;http://forecast.weather.gov/MapClick.php?lat&#61;&#39;&#43;c.latitude&#43;&#39;&amp;lon&#61;&#39;&#43;c.longitude;&#125;,function&#40;&#41;&#123;alert&#40;&#39;Permission&#37;20denied.&#39;&#41;&#125;&#41;;">The NOAA’s weather forecast</a>, for example&#41;:</p>
<pre><code class="javascript hljs"><span class=hljs-attr >javascript</span>:navigator.<span class=hljs-property >geolocation</span>.<span class="hljs-title function_">getCurrentPosition</span>(<span class=hljs-keyword >function</span>(<span class=hljs-params >g</span>){c=g.<span class=hljs-property >coords</span>;<span class="hljs-variable language_">window</span>.<span class=hljs-property >location</span>=<span class=hljs-string >&quot;http://forecast.weather.gov/MapClick.php?lat=&quot;</span>+c.<span class=hljs-property >latitude</span>+<span class=hljs-string >&quot;&amp;lon=&quot;</span>+c.<span class=hljs-property >longitude</span>;},<span class=hljs-keyword >function</span>(<span class=hljs-params ></span>){<span class="hljs-title function_">alert</span>(<span class=hljs-string >&quot;Permission denied.&quot;</span>)});</code></pre>
<p>Now if only I could find a way to save the javascript bookmark to the Home Screen, I’d be set&#33;</p>

<div class=page-foot >
  <div class=copyright >
    &copy; Matt Bauman. Last modified: July 14, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>

</div>