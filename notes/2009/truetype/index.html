<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel=stylesheet  href="/libs/highlight/github.min.css"> <link rel=stylesheet  href="/css/franklin.css"> <link rel=stylesheet  href="/css/basic.css"> <link rel=icon  href="/assets/favicon.png"> <script src="https://kit.fontawesome.com/8106cce1f2.js" crossorigin=anonymous ></script> <title>Minor Truetype Font Editing on a Mac</title> <header> <div class=blog-name ><a href="/">Matt Bauman</a></div> <nav> <ul> <li><a href="/">Home</a> <li><a href="/research/">Research+</a> <li><a href="/projects/">Projects</a> <li><a href="/notes/">Notes</a> </ul> <img src="/assets/hamburger.svg" id=menu-icon > </nav> </header> <div class="franklin-content container blog-title"> <h1>Minor Truetype Font Editing on a Mac </h1> <h3> <span style="font-weight: lighter; font-style: italic; font-size:smaller"> 3 March 2009 <a type="application/rss+xml" href="/feed.xml"> <i class="fas fa-rss" ></i> </a> </span> </h3> </div> <div class=franklin-content ><h4 id=also_how_to_fix_consolas_baseline ><a href="#also_how_to_fix_consolas_baseline" class=header-anchor ><em>&#40;also: how to fix Consolas&#39; baseline&#41;</em></a></h4> <p> <p style="float:left"> <img src="/assets/notes/consolas-suite.png" alt="The suite of new MS fonts"> </p> <em>Update December 5, 2011: Changed download link to the most recent version of Apple Font Tool suite, which is now x86 compatible.</em></p> <p>With the release of Windows Vista, Microsoft included six new fonts that they commissioned for the occasion. They are the new defaults for Vista and Office. They’ve also made them available for Mac through Office as well as a handful of free &#40;as in beer&#41; utilities. I got them by following <a href="https://web.archive.org/web/20160315092834/http://www.wezm.net/technical/2009/03/install-consolas-mac-osx/">these instructions</a>.</p> <p>These new modern fonts are explicitly designed for display on computer screens with ClearType. Although Apple has a <a href="http://www.codinghorror.com/blog/archives/000884.html">different philosophy on font rendering</a>, the same basic premise is used in OS X. Besides all that &#40;or, rather, because of it&#41; these fonts are very pretty.</p> <p>But there’s a problem, and you can see it in the image above. When packaging these fonts up for the Mac, Microsoft goofed on the baseline for Consolas. The icon previews below show it much more obviously.</p> <p><img src="/assets/notes/consolas-baselines.png" alt="Icon previews with baselines" /></p> <p>In short: it’s annoying. And wrong. And the fix is after the break.</p> <p>A bunch of Mac geeks across <a href="http://www.google.com/search?hl&#61;en&amp;rls&#61;en-us&amp;q&#61;consolas&#43;mac">the web</a> <a href="http://bandes-storch.net/blog/2008/12/21/consolas-controlled/">have</a> <a href="http://www.command-tab.com/2008/12/16/consolas-cursor-fix/">run</a> into this, but nobody has solved it completely. After stumbling across <a href="http://bandes-storch.net/blog/2008/12/21/consolas-controlled/#comment-2042">an oblique reference</a> to some sort of metrics table embedded in the font, I started looking for a way to edit it. That’s when I happened across Apple’s suite of command line font editing tools. The main “workhorse” of the suite is <code>ftxdumperfuser</code>, but it doesn’t edit the TTF files directly. Rather, it ‘dumps’ the TrueType data into plain text &#40;xml&#41; tables that you can edit and then ‘fuses’ the changes back into the font. Google has surprisingly little on this suite… it wasn’t easy to find &#40;Hence this post&#41;.</p> <p>Now, before going any further, a word of warning: Corrupted fonts can be <strong>very very bad</strong>. I did all this with an uninstalled font outside of the <code>*/Library/Fonts</code> directory. OS X is much more robust with font management than it used to be &#40;Font Book will catch corruption before installing a font&#41;, but a corrupt font can still really mess stuff up. Continue at your own risk…</p> <p>Download Apple’s <a href="https://developer.apple.com/downloads/index.action">OS X Font Tools</a>—it will install the tools into <code>/usr/bin</code> and the documentation into <code>/Developer/Documentation/FontTools</code>.</p> <p>Fire up Terminal, and navigate to the folder where you moved the Consolas*.ttf fonts. Now, you want to dump &#40;<code>-A d</code>&#41; the height metrics &#40;<code>hhea</code>&#41; table &#40;<code>-t</code>&#41; into an editable xml file:</p> <pre><code class="julia hljs">ftxdumperfuser -t hhea -A d Consolas.ttf</code></pre>
<p>This creates an xml file in that directory titled Consolas.hhea.xml. Now the table parameters are editable&#33; Open that xml file and correct the ascender, descender, and lineGap metrics:</p>
<pre><code class="xml hljs"><span class=hljs-tag >&lt;<span class=hljs-name >hheaTable</span>
   <span class=hljs-attr >...</span>
   <span class=hljs-attr >ascender</span>=<span class=hljs-string >&quot;1884&quot;</span>
   <span class=hljs-attr >descender</span>=<span class=hljs-string >&quot;-514&quot;</span>
   <span class=hljs-attr >lineGap</span>=<span class=hljs-string >&quot;0&quot;</span>
   <span class=hljs-attr >...</span>
   /&gt;</span></code></pre>
<p>And then fuse &#40;<code>-A f</code>&#41; it back into the font:</p>
<pre><code class="julia hljs">ftxdumperfuser -t hhea -A f Consolas.ttf</code></pre>
<p>Repeat for each member of the family, and you’re done&#33;</p>
<p>It’s a pretty cool suite. Emboldened by my success, I decided to modify a few glyphs that had been bugging me. I had previously tried to edit the TTF using the free FontForge, but never had any success recompiling it back into a complete proper font. The result always failed Font Book’s validation and often would display gibberish if I overrode it. I believe that the FontForge’s TTF import implementation isn’t quite complete, so it wasn’t exporting the complete font information.</p>
<p>With the <code>&#39;glyf&#39;</code> table, you can edit the raw hex that describes the contours of each glyph. So, I edited the glyphs I wanted in FontForge, and exported the TTF. While the font file didn’t work as a whole it still contained all the proper glyf information. I dumped the glyph info, grabbed the one I wanted, subbed it into the dump from the original, and fused it back together. And it worked&#33; Now I have a proper baseline, and a Monaco style ‘l’ without the lower left serif &#40;and the ‘i,’ too, for consistency&#41;.</p>
<p>Here’s the Hex data I used &#40;139 is defined as the glyphRefID in the ‘cmap’ table for ‘i’, and 142 is ‘l’&#41;:</p>
<p>Consolas.glyf.xml:</p>
<pre><code class="xml hljs"><span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >&quot;139&quot;</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >&quot;2&quot;</span> <span class=hljs-attr >top</span>=<span class=hljs-string >&quot;1425&quot;</span> <span class=hljs-attr >left</span>=<span class=hljs-string >&quot;183&quot;</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >&quot;0&quot;</span> <span class=hljs-attr >right</span>=<span class=hljs-string >&quot;955&quot;</span> <span class=hljs-attr >data</span>=<span class=hljs-string >&quot;000200B7000003BB05910009001D 0041BC000F01FD0019000401B1400E090109010906071E0409F607510AB80128400A14401014481400F5034F003FEDDE2BED3FED320110D6CD39392F2F10E1D4E13130 01213521112115213D0113321E0215140E0223222E0235343E0201E0FED701D9012BFE253D1D3225151525321D1D322515152532035C90FCA5915A3705001526311D1C3226151526321C1D31261500&quot;</span> /&gt;</span>
&lt;!-  <span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >”139”</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >”2”</span> <span class=hljs-attr >top</span>=<span class=hljs-string >”1425”</span> <span class=hljs-attr >left</span>=<span class=hljs-string >”183”</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >”0”</span> <span class=hljs-attr >right</span>=<span class=hljs-string >”955”</span> <span class=hljs-attr >data</span>=<span class=hljs-string >”000200B7000003BB05910009001D000001213521112115213D0113321E0215140E0223222E0235343E0201E0FED701D9012BFE253D1D3225151525321D1D322515152532035C90FCA5915A3705001526311D1C3226151526321C1D31261500”</span> /&gt;</span> -&gt;
&lt;!-    0 ( 0) 0001 ( 480, 860 ) -&gt;
&lt;!-    1 ( 0) 0001 ( 183, 860 ) -&gt;
&lt;!-    2 ( 0) 0001 ( 183, 1004 ) -&gt;
&lt;!-    3 ( 0) 0001 ( 656, 1004 ) -&gt;
&lt;!-    4 ( 0) 0001 ( 656, 145 ) -&gt;
&lt;!-    5 ( 0) 0001 ( 955, 145 ) -&gt;
&lt;!-    6 ( 0) 0001 ( 955, 0 ) -&gt;
&lt;!-    7 ( 0) 0001 ( 480, 0 ) -&gt;
&lt;!-    8 ( 0) 0001 ( 480, 90 ) -&gt;
&lt;!-    9 ( 0) 0001 ( 480, 145 ) -&gt;
&lt;!-   10 ( 1) 0001 ( 541, 1425 ) -&gt;
&lt;!-   11 ( 1) 0000 ( 570, 1425 ) -&gt;
&lt;!-   12 ( 1) 0000 ( 620, 1404 ) -&gt;
&lt;!-   13 ( 1) 0000 ( 657, 1366 ) -&gt;
&lt;!-   14 ( 1) 0000 ( 678, 1317 ) -&gt;
&lt;!-   15 ( 1) 0001 ( 678, 1288 ) -&gt;
&lt;!-   16 ( 1) 0000 ( 678, 1260 ) -&gt;
&lt;!-   17 ( 1) 0000 ( 657, 1210 ) -&gt;
&lt;!-   18 ( 1) 0000 ( 620, 1172 ) -&gt;
&lt;!-   19 ( 1) 0000 ( 570, 1151 ) -&gt;
&lt;!-   20 ( 1) 0001 ( 541, 1151 ) -&gt;
&lt;!-   21 ( 1) 0000 ( 512, 1151 ) -&gt;
&lt;!-   22 ( 1) 0000 ( 462, 1172 ) -&gt;
&lt;!-   23 ( 1) 0000 ( 425, 1210 ) -&gt;
&lt;!-   24 ( 1) 0000 ( 404, 1260 ) -&gt;
&lt;!-   25 ( 1) 0001 ( 404, 1288 ) -&gt;
&lt;!-   26 ( 1) 0000 ( 404, 1317 ) -&gt;
&lt;!-   27 ( 1) 0000 ( 425, 1366 ) -&gt;
&lt;!-   28 ( 1) 0000 ( 462, 1404 ) -&gt;
&lt;!-   29 ( 1) 0000 ( 512, 1425 ) -&gt;</code></pre>
<p>...</p>
<pre><code class="xml hljs"><span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >&quot;142&quot;</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >&quot;1&quot;</span> <span class=hljs-attr >top</span>=<span class=hljs-string >&quot;1413&quot;</span> <span class=hljs-attr >left</span>=<span class=hljs-string >&quot;153&quot;</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >&quot;0&quot;</span> <span class=hljs-attr >right</span>=<span class=hljs-string >&quot;983&quot;</span> <span class=hljs-attr >data</span>=<span class=hljs-string >&quot;00010099000003D705850009 004FB10102435558B40202090803B80211400F0609090A0B0409FA075100FA40025300183F1A4DED3FED32111201392FCDFDC411392F31301B400A0409FA075100FA40025300183F1A4DED3FED32313059 01213521112115213D0101B8FEE102190125FDE104C7BEFB39BE7C42000000&quot;</span> /&gt;</span>
&lt;!-  <span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >”142”</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >”1”</span> <span class=hljs-attr >top</span>=<span class=hljs-string >”1413”</span> <span class=hljs-attr >left</span>=<span class=hljs-string >”153”</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >”0”</span> <span class=hljs-attr >right</span>=<span class=hljs-string >”983”</span> <span class=hljs-attr >data</span>=<span class=hljs-string >”00010099000003D705850009000001213521112115213D0101B8FEE102190125FDE104C7BEFB39BE7C42000000”</span> /&gt;</span>  -&gt;
&lt;!-    0 ( 0) 0001 ( 440, 1223 ) -&gt;
&lt;!-    1 ( 0) 0001 ( 153, 1223 ) -&gt;
&lt;!-    2 ( 0) 0001 ( 153, 1413 ) -&gt;
&lt;!-    3 ( 0) 0001 ( 690, 1413 ) -&gt;
&lt;!-    4 ( 0) 0001 ( 690, 190 ) -&gt;
&lt;!-    5 ( 0) 0001 ( 983, 190 ) -&gt;
&lt;!-    6 ( 0) 0001 ( 983, 0 ) -&gt;
&lt;!-    7 ( 0) 0001 ( 440, 0 ) -&gt;
&lt;!-    8 ( 0) 0001 ( 440, 124 ) -&gt;
&lt;!-    9 ( 0) 0001 ( 440, 190 ) -&gt;</code></pre>
<p>Consolas Bold.glyf.xml:</p>
<pre><code class="xml hljs"><span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >&quot;139&quot;</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >&quot;2&quot;</span> <span class=hljs-attr >top</span>=<span class=hljs-string >&quot;1454&quot;</span> <span class=hljs-attr >left</span>=<span class=hljs-string >&quot;153&quot;</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >&quot;0&quot;</span> <span class=hljs-attr >right</span>=<span class=hljs-string >&quot;983&quot;</span> <span class=hljs-attr >data</span>=<span class=hljs-string >&quot;00020099000003D705AE0013001D 007FB10102435558BC000A023C00000018021140121D1C151D19191D151C041E1F181DFA1B510FB8014B400D0F051F050218030514FA40164F00183F1A4DEDDE5F5E5DED3FED3211120117392F2F2F2F10FDD4ED31301BB5181DFA1B510FB8014B400D0F051F050218030514FA40164F00183F1A4DEDDE5F5E5DED3FED32313059 01140E0223222E0235343E0233321E0201213521112115213D0102C6182B3A22223B2B18182B3B22223A2B18FEF2FEE102190125FDE1050E213A2B19192B3A21213A2C19192C3AFE0BBEFCC6BEAA140000&quot;</span> /&gt;</span>
&lt;!-  <span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >”139”</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >”2”</span> <span class=hljs-attr >top</span>=<span class=hljs-string >”1454”</span> <span class=hljs-attr >left</span>=<span class=hljs-string >”153”</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >”0”</span> <span class=hljs-attr >right</span>=<span class=hljs-string >”983”</span> <span class=hljs-attr >data</span>=<span class=hljs-string >”00020099000003D705AE0013001D000001140E0223222E0235343E0233321E0201213521112115213D0102C6182B3A22223B2B18182B3B22223A2B18FEF2FEE102190125FDE1050E213A2B19192B3A21213A2C19192C3AFE0BBEFCC6BEAA140000”</span> /&gt;</span>   -&gt;
&lt;!-    0 ( 0) 0001 ( 710, 1294 ) -&gt;
&lt;!-    1 ( 0) 0000 ( 710, 1261 ) -&gt;
&lt;!-    2 ( 0) 0000 ( 686, 1203 ) -&gt;
&lt;!-    3 ( 0) 0000 ( 643, 1160 ) -&gt;
&lt;!-    4 ( 0) 0000 ( 585, 1135 ) -&gt;
&lt;!-    5 ( 0) 0001 ( 551, 1135 ) -&gt;
&lt;!-    6 ( 0) 0000 ( 517, 1135 ) -&gt;
&lt;!-    7 ( 0) 0000 ( 458, 1160 ) -&gt;
&lt;!-    8 ( 0) 0000 ( 415, 1203 ) -&gt;
&lt;!-    9 ( 0) 0000 ( 391, 1261 ) -&gt;
&lt;!-   10 ( 0) 0001 ( 391, 1294 ) -&gt;
&lt;!-   11 ( 0) 0000 ( 391, 1327 ) -&gt;
&lt;!-   12 ( 0) 0000 ( 415, 1385 ) -&gt;
&lt;!-   13 ( 0) 0000 ( 458, 1429 ) -&gt;
&lt;!-   14 ( 0) 0000 ( 517, 1454 ) -&gt;
&lt;!-   15 ( 0) 0001 ( 551, 1454 ) -&gt;
&lt;!-   16 ( 0) 0000 ( 585, 1454 ) -&gt;
&lt;!-   17 ( 0) 0000 ( 643, 1429 ) -&gt;
&lt;!-   18 ( 0) 0000 ( 686, 1385 ) -&gt;
&lt;!-   19 ( 0) 0000 ( 710, 1327 ) -&gt;
&lt;!-   20 ( 1) 0001 ( 440, 826 ) -&gt;
&lt;!-   21 ( 1) 0001 ( 153, 826 ) -&gt;
&lt;!-   22 ( 1) 0001 ( 153, 1016 ) -&gt;
&lt;!-   23 ( 1) 0001 ( 690, 1016 ) -&gt;
&lt;!-   24 ( 1) 0001 ( 690, 190 ) -&gt;
&lt;!-   25 ( 1) 0001 ( 983, 190 ) -&gt;
&lt;!-   26 ( 1) 0001 ( 983, 0 ) -&gt;
&lt;!-   27 ( 1) 0001 ( 440, 0 ) -&gt;
&lt;!-   28 ( 1) 0001 ( 440, 170 ) -&gt;
&lt;!-   29 ( 1) 0001 ( 440, 190 ) -&gt;</code></pre>
<p>...</p>
<pre><code class="xml hljs"><span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >&quot;142&quot;</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >&quot;1&quot;</span> <span class=hljs-attr >top</span>=<span class=hljs-string >&quot;1413&quot;</span> <span class=hljs-attr >left</span>=<span class=hljs-string >&quot;183&quot;</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >&quot;0&quot;</span> <span class=hljs-attr >right</span>=<span class=hljs-string >&quot;955&quot;</span> <span class=hljs-attr >data</span>=<span class=hljs-string >&quot;000100B7000003BB05850009 002AB9000401B14011090109010906070A0409F6075100D50353003FED3FED320110D6CD39392F2F10E13130 01213521112115213D0101E0FED701D9012BFE2504F68FFB0C91464B&quot;</span> /&gt;</span>
&lt;!-  <span class=hljs-tag >&lt;<span class=hljs-name >glyphData</span> <span class=hljs-attr >glyphRefID</span>=<span class=hljs-string >”142”</span> <span class=hljs-attr >nContours</span>=<span class=hljs-string >”1”</span> <span class=hljs-attr >top</span>=<span class=hljs-string >”1413”</span> <span class=hljs-attr >left</span>=<span class=hljs-string >”183”</span> <span class=hljs-attr >bottom</span>=<span class=hljs-string >”0”</span> <span class=hljs-attr >right</span>=<span class=hljs-string >”955”</span> <span class=hljs-attr >data</span>=<span class=hljs-string >”000100B7000003BB05850009000001213521112115213D0101E0FED701D9012BFE2504F68FFB0C91464B”</span> /&gt;</span>  -&gt;
&lt;!-    0 ( 0) 0001 ( 480, 1270 ) -&gt;
&lt;!-    1 ( 0) 0001 ( 183, 1270 ) -&gt;
&lt;!-    2 ( 0) 0001 ( 183, 1413 ) -&gt;
&lt;!-    3 ( 0) 0001 ( 656, 1413 ) -&gt;
&lt;!-    4 ( 0) 0001 ( 656, 145 ) -&gt;
&lt;!-    5 ( 0) 0001 ( 955, 145 ) -&gt;
&lt;!-    6 ( 0) 0001 ( 955, 0 ) -&gt;
&lt;!-    7 ( 0) 0001 ( 480, 0 ) -&gt;
&lt;!-    8 ( 0) 0001 ( 480, 70 ) -&gt;
&lt;!-    9 ( 0) 0001 ( 480, 145 ) -&gt;</code></pre>
<div class=page-foot >
  <div class=copyright >
    &copy; Matt Bauman. Last modified: July 12, 2024. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>